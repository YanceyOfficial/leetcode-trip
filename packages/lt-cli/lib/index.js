import t from"chalk";import e from"clear";import n from"figlet";import{select as a,search as o}from"@inquirer/prompts";import{readdirSync as r,readFileSync as s,existsSync as c,writeFileSync as i}from"node:fs";import{kebabCase as l}from"change-case";import m from"ora";import{sleep as u}from"yancey-js-util";import{execa as d}from"execa";import f from"node-fetch";import{compareVersions as p}from"compare-versions";var y;!function(t){t.Easy="easy",t.Medium="medium",t.Hard="hard"}(y||(y={}));const $=`${process.cwd()}/src/leetcode/javascript`,g=`${process.cwd()}/src/leetcode/rust`,h=`${process.cwd()}/leetcode-docs`,b=[{name:y.Easy,value:y.Easy},{name:y.Medium,value:y.Medium},{name:y.Hard,value:y.Hard}],w=(t,e)=>{const n=s(`${$}/${t}/${e}`,{encoding:"utf-8"}),[a,o]=e.split("."),{functionName:r,functionBody:c}=(t=>{const e=t.match(/\/\/ @lc code=start([\s\S]*)?\/\/ @lc code=end/im);if(Array.isArray(e)){const t=e[1],n=t.match(/var([\s\S]*?)=/i);if(Array.isArray(n)){const e=n[1].trim();return{functionBody:t,functionName:l(e)}}throw new Error("Can not get the function name string.")}throw new Error("Can not get the function body string.")})(n);return{outPath:`${h}/${t.toLowerCase()}/${a}-${r}.mdx`,meta:{serial:a,title:o,functionName:r,functionBody:c}}},v=(t,e)=>o({message:"Select file: ",source:async t=>e.filter(e=>e.name.includes(t||"")),validate:e=>((t,e)=>{const{outPath:n}=w(t,e);return!c(n)||"File already exists, please select another."})(t,e)}),x=async(t,e)=>{const n=w(t,e);if("object"!=typeof n)return;const{outPath:a,meta:{serial:o,title:s,functionBody:c,functionName:l}}=n,d=m("Creating...").start();await u(),i(a,((t,e,n,a)=>`---\nid: ${t}-${n}\ntitle: ${e}\nsidebar_label: ${t}. ${e}\nkeywords:\n  - HashMap\n---\n\n:::success Tips\n题目类型: HashMap\n\n相关题目:\n\n- [1. 两数之和](/leetcode/easy/1-two-sum)\n\n:::\n\n## 题目\n\n这里是题目这里是题目这里是题目这里是题目这里是题目\n\n:::note 提示:\n\n- xxxxxxxxx\n\n:::\n\n:::info 示例\n\n输入:\n\n输出:\n:::\n\n## 题解\n\n这里是题解这里是题解这里是题解这里是题解这里是题解\n\nimport Tabs from '@theme/Tabs'\nimport TabItem from '@theme/TabItem'\n\n<Tabs>\n  <TabItem value="JavaScript" label="JavaScript" default>\n\n\`\`\`ts\n${a}\n\`\`\`\n\n</TabItem>\n<TabItem value="Rust" label="Rust">\n\n\`\`\`rust\npub fn foo() -> () {\n}\n\`\`\`\n\n</TabItem>\n</Tabs>\n`)(o,s,l,c)),i(`${g}/src/${t}/question_${o}.rs`,"#[allow(unused)]\npub fn foo() -> () {}\n"),(t=>{const e=r(`${g}/src/${t}`).filter(t=>"mod.rs"!==t).map(t=>`pub mod ${t.replace(".rs","")};`);i(`${g}/src/${t}/mod.rs`,e.join("\n"))})(t),d.stop(),m().succeed("Template created successfully!")},E=async()=>{e(),console.log(t.blue(n.textSync("LEETCODE TRIP",{horizontalLayout:"default",verticalLayout:"default"})));try{const t=await(async()=>a({message:"Select difficulty: ",choices:b}))(),e=r(`${$}/${t}`).sort((t,e)=>+t.split(".")[0]-+e.split(".")[0]).map(t=>({name:t,value:t})),n=await v(t,e);await x(t,n)}catch(t){t instanceof Error&&"ExitPromptError"===t.name&&console.log("Goodbye~")}},T=r(`${$}/${y.Easy}`).length,H=r(`${$}/${y.Medium}`).length,I=r(`${$}/${y.Hard}`).length,M=T+H+I,S=[{category:y.Easy,count:T},{category:y.Medium,count:H},{category:y.Hard,count:I},{category:"Total",count:M}],j=()=>{console.table(S)},C=async e=>{const n=await(async()=>{const t=await f("https://registry.npmjs.org/@yancey-inc/lt-cli"),e=await t.json(),{latest:n}=e["dist-tags"];return n})(),a=1===p(n,e);return a?console.log(t.red(`\nLatest version is v${n}. Your version v${e} is out-of-date and will be upgraded.`)):console.log(t.green(`\nAlready the latest version v${n}, no upgrade needed.`)),a},A=async e=>{const n=m("Checking for latest version...").start(),a=await C(e);n.stop(),a&&await(async()=>{const e=m("Upgrading...").start();try{await d("pnpm",["install","@yancey-inc/lt-cli@latest","-g","--verbose"],{stdio:"inherit"}),m().succeed("Upgrade successful!")}catch(e){console.log(t.red(e instanceof Error?e.message:"Unknown Error"))}finally{e.stop()}})()};export{E as bootstrap,j as showStatistics,A as upgrade};
